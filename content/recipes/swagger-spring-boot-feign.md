+++
categories = ["recipes"]
date = "2017-05-04T10:49:45-04:00"
glyph = "fa-file-text-o"
summary = "Bootstraping Spring Boot Applications with Swagger Codegen"
tags = ["swagger", "codegen", "spring boot", "feign"]
title = "Use Swagger Codegen to generate Microservices."
taxonomy = ["API-FIRST"]
review_status = ["DONE"]
+++
## Overvew

This project demonstrates how [swagger-codegen](https://github.com/swagger-api/swagger-codegen) can be
used to generate a functional Spring Boot Applications integrated with Eureka, and communicating via Feign.

Development of Microservices could employ this workflow to generate a boilerplate server stub REST APIs, and classes to be included
in client services.

[Working project is available on github.](https://github.com/poprygun/swag-game)

![Module Diagram](/documents/swagger-codegen-spring-boot/swagger-codegen-1.png)

## Workflow

### Define APIs of _Randomize_ module

Use [Swagger Codegen Editor](http://editor.swagger.io/) to define, and experiment with swagger codegen template.  Save the file in `randomize/config/api-definitions.yml`

Generate Server Stubs.  Generated classes are located in `randomize/target/generated-sources/swagger` directory.

From `randomize` directory:

```bash
mvn package
```

Write implementation of the generated stubs by extending Api classes.  **No modifications should ever be made to generated code**

```java
package io.pivotal.microsamples.api;

import io.pivotal.microsamples.model.Health;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class RandomizeApiImpl implements RandomizeApi {

    @Override
    public ResponseEntity<Health> health() {
        Health health = new Health();
        health.setHealth("I happen to be alive !!!");
        return new ResponseEntity<Health>(health, HttpStatus.OK);
    }
}
```

### Generate _Randomize Client_ to be included as a dependency by the clients of _Randomize_ module.

Swagger generator template file is located in `randomize-client/config/api-definitions.yml`.  This file is almost identical to a template defined in _Randomize_, and could potentially be published to be used by both modules.

Following command assumes that randomize-client.jar will be published to local mvn repository.  Alternatively, additional steps must be taking to publish it to online repository.

From `randomize-client`:

```bash
mvn install
```

At this point, modules that need to use _Randomize_ API could include randomize-client.jar

```xml
<dependency>
    <groupId>io.pivotal.micro-samples</groupId>
    <artifactId>randomizer-client</artifactId>
    <version>1.0.1</version>
</dependency>
```

_Guesser_ module is an example client application that consumes _Randomizer_ API.
Its own API was also generated by swagger generator.

From `guesser` directory:

```bash
mvn package
```

Controller that implements generated _Guesser_ API, and consumes _Randomizer_ API using `io.pivotal.microsamples.api.PhraseApiClient`, imported with randomizer-client.jar

```java
package io.pivotal.microsamples.api;

import io.pivotal.microsamples.guesser.api.GuessApi;
import io.pivotal.microsamples.guesser.model.Guess;
import io.pivotal.microsamples.guesser.model.Health;
import io.pivotal.microsamples.model.Phrase;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.RestController;

import java.util.ArrayList;
import java.util.List;

@RestController
public class GuessApiImpl implements GuessApi {

 	@Autowired
	private PhraseApiClient phraseApiClient;

    @Override
    public ResponseEntity<List<Guess>> allGuesses() {
        ResponseEntity<List<Phrase>> responseFromRandomizer = phraseApiClient.allPhrases();

        List<Guess> guesses = new ArrayList<>();
        for (Phrase phrase : responseFromRandomizer.getBody()) {
            addPhraseToGuesses(guesses, phrase);
        }

        return new ResponseEntity<>(guesses, HttpStatus.OK);
    }

    private void addPhraseToGuesses(List<Guess> guesses, Phrase phrase) {
        Guess guess = new Guess();
        guess.setGuessDate(phrase.getGuessDate());
        guess.setGuessedPhrase(phrase.getGuessedPhrase());
        guess.setGuessed(phrase.getGuessed());
        guess.setId(phrase.getId());
        guesses.add(guess);
    }

    @Override
    public ResponseEntity<Health> health() {
        Health health = new Health();
        health.setHealth("Guesser is alive!");
        return new ResponseEntity<>(health, HttpStatus.OK);
    }
}
```

Start services

From `service-discovery`, `randomize`, `guesser` directories:

```bash
mvn spring-boot:run
```

## Components

See README files under specific module for detailed description of component functionality.

### _Randomize_ is an example of Microservice Server with advertised API as follows.

| URL | Description |
|-----|-------------|
| v2/health | Health endpoint |
| v2/randomize/allPhrases | Generated Phrases |

### _Randomize-client_

Abstracts the artifacts needed to perform REST calls to _Randomize_ server.  This module is 100% generated code.  Any modifications should be sourced from `randomize-client/config/api-definitions.yml`.

### _Guesser_

Is an example of Microservice Client that communicates to _Randomize_ using _Randomize-client_ library.

| URL | Description |
|-----|-------------|
| v2/guess | Health endpoint |
| v2/guess/allGuesses | Queries Randomize server using Feign |
